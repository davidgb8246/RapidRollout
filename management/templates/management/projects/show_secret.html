{% extends '../base.html' %}

{% block title %}Secret - RapidRollout{% endblock %}

{% block content %}
<style>
    body {
        background-color: #1e1e1e;
        color: #f8f9fa;
    }

    .card-custom {
        background-color: #2c2f33;
        border-radius: 0.5rem;
        padding: 2rem 2.5rem;
        max-width: 480px;
        margin: 3rem auto;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        color: #f8f9fa;
        text-align: center;
    }

    h3 {
        margin-bottom: 1.5rem;
        font-weight: 600;
        color: #fff;
    }

    p {
        margin-bottom: 1.2rem;
        font-size: 1rem;
        line-height: 1.5;
    }

    p strong {
        font-weight: 700;
        color: #e3e3e3;
    }

    .secret-key {
        font-family: monospace, monospace;
        font-size: 1.4em;
        background-color: #3a3b3c;
        padding: 0.8rem 1rem;
        border-radius: 0.4rem;
        user-select: all;
        word-break: break-all;
        margin-bottom: 1.5rem;
        cursor: pointer;
        position: relative;
        transition: background-color 0.3s ease;
    }

    .secret-key:hover {
        background-color: #4c6ef5;
        color: #fff;
    }

    .copy-success {
        color: #4BB543;
        font-weight: 600;
        margin-top: 0.5rem;
        display: none;
    }

    a.back-link {
        display: inline-block;
        background-color: #5c7cfa;
        color: white;
        padding: 0.6rem 1.2rem;
        border-radius: 0.4rem;
        font-weight: 600;
        text-decoration: none;
        transition: background-color 0.3s ease;
    }

    a.back-link:hover {
        background-color: #4c6ef5;
    }

    .copy-success {
        display: none;
        color: #4BB543;
        font-weight: 700;
        margin: 0 auto 1.2rem auto;
        padding: 0.4rem 1rem;
        background-color: rgba(75, 181, 67, 0.15);
        border: 1.5px solid #4BB543;
        border-radius: 0.4rem;
        width: fit-content;
        user-select: none;
        box-shadow: 0 0 8px rgba(75, 181, 67, 0.4);
        transition: opacity 0.3s ease;
        opacity: 0;
        pointer-events: none;
        font-size: 0.95rem;
        text-align: center;
    }

    .copy-success.show {
        display: block;
        opacity: 1;
        pointer-events: auto;
    }
</style>

<div class="card card-custom">
    <h3>Secret Created</h3>
    <p><strong>This is your secret key. Click it to copy â€” you won't see it again:</strong></p>
    <div class="copy-success" id="copySuccess">Copied!</div>
    <p class="secret-key" id="secretKey" title="Click to copy">{{ secret }}</p>
    <a href="{% url 'project_list' %}" class="back-link">Back to Projects</a>
</div>

<script>
    const secretKey = document.getElementById('secretKey');
    const copySuccess = document.getElementById('copySuccess');

    secretKey.addEventListener('click', () => {
        const textToCopy = secretKey.innerText;

        function showSuccess() {
            copySuccess.classList.add('show');
            setTimeout(() => {
                copySuccess.classList.remove('show');
            }, 2000);
        }

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(textToCopy).then(() => {
                showSuccess();
            }).catch(() => {
                fallbackCopyTextToClipboard(textToCopy, showSuccess);
            });
        } else {
            fallbackCopyTextToClipboard(textToCopy, showSuccess);
        }
    });

    function fallbackCopyTextToClipboard(text, callback) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.top = "-9999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            const successful = document.execCommand('copy');
            if (successful && callback) callback();
            else alert('Failed to copy to clipboard. Please copy manually.');
        } catch (err) {
            alert('Failed to copy to clipboard. Please copy manually.');
        }

        document.body.removeChild(textArea);
    }
</script>
{% endblock %}
