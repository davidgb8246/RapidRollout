{% extends '../base.html' %}

{% block title %}All Users - RapidRollout{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background-color: #1e1e1e;
        color: #f8f9fa;
    }

    h2 {
        margin-bottom: 1.5rem;
        color: #fff;
    }

    a {
        color: #5c7cfa;
        text-decoration: none;
        transition: color 0.2s ease-in-out;
    }

    a:hover {
        color: #4c6ef5;
    }

    .new-user-link {
        display: inline-block;
        margin-bottom: 1rem;
        padding: 0.5rem 1rem;
        background-color: #3b82f6;
        border-radius: 0.375rem;
        font-weight: 600;
        color: #fff;
        transition: background-color 0.3s ease;
    }

    .new-user-link:hover {
        background-color: #2563eb;
        color: #fff;
    }

    ul.user-list {
        list-style: none;
        padding-left: 0;
    }

    ul.user-list li {
        background-color: #2c2f33;
        margin-bottom: 0.75rem;
        padding: 0.8rem 1rem;
        border-radius: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 500;
    }

    ul.user-list li span.username {
        flex-grow: 1;
        overflow-wrap: anywhere;
    }

    .btn-edit {
        background-color: #10b981;
        color: #fff;
        padding: 0.3rem 0.7rem;
        border-radius: 0.3rem;
        font-weight: 600;
        border: none;
        margin-right: 0.5rem;
    }

    .btn-edit:hover {
        background-color: #047857;
    }

    .btn-delete {
        background-color: #ef4444;
        color: #fff;
        padding: 0.3rem 0.7rem;
        border-radius: 0.3rem;
        font-weight: 600;
        border: none;
    }

    .btn-delete:hover {
        background-color: #b91c1c;
    }

    .modal.fade .modal-dialog {
        transform: translateY(-50px);
        transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    }

    .modal.show .modal-dialog {
        transform: translateY(0);
    }
</style>

<h2>All Users</h2>
<a href="{% url 'create_user' %}" class="new-user-link">+ Create New User</a>

<ul class="user-list">
    {% for user in users %}
        <li>
            <span class="username">{{ user.username }}</span>
            <a href="{% url 'edit_user' user.profile.id %}" class="btn btn-edit">Edit</a>
            <button
                class="btn btn-delete btn-show-modal"
                data-bs-toggle="modal"
                data-bs-target="#deleteModal"
                data-username="{{ user.username }}"
                data-delete-url="{% url 'delete_user' user.profile.id %}"
            >
                Delete
            </button>
        </li>
    {% empty %}
        <li class="no-users text-muted text-center fst-italic">No users found.</li>
    {% endfor %}
</ul>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white border-secondary">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete <strong id="modalUsername"></strong>?
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

<script>
    const deleteModal = document.getElementById('deleteModal');
    const confirmBtn = document.getElementById('confirmDeleteBtn');
    const modalUsername = document.getElementById('modalUsername');

    deleteModal.addEventListener('show.bs.modal', event => {
        const button = event.relatedTarget;
        const username = button.getAttribute('data-username');
        const deleteUrl = button.getAttribute('data-delete-url');
        modalUsername.textContent = username;
        confirmBtn.href = deleteUrl;
    });
</script>
{% endblock %}
